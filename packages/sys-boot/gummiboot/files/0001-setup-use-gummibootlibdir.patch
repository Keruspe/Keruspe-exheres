Upstream: yes
From 3df79959a6aeabcd7c0c0e038039c12ab061a7d9 Mon Sep 17 00:00:00 2001
From: Marc-Antoine Perennou <Marc-Antoine@Perennou.com>
Date: Sat, 9 Mar 2013 19:14:56 +0100
Subject: [PATCH] setup: use gummibootlibdir

Signed-off-by: Marc-Antoine Perennou <Marc-Antoine@Perennou.com>
---
 Makefile.am       | 1 +
 src/setup/setup.c | 6 +++---
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index d3d3a04..1e21c40 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -46,6 +46,7 @@ gummiboot_CFLAGS = \
 	$(AM_CFLAGS) \
 	-Wno-unused-parameter -D_GNU_SOURCE \
 	-DMACHINE_TYPE_NAME=\"$(MACHINE_TYPE_NAME)\" \
+	-DGUMMIBOOTLIBDIR=\"$(gummibootlibdir)\" \
 	$(BLKID_CFLAGS)
 
 gummiboot_LDADD = \
diff --git a/src/setup/setup.c b/src/setup/setup.c
index b804138..c5eb9d8 100644
--- a/src/setup/setup.c
+++ b/src/setup/setup.c
@@ -740,7 +740,7 @@ static int copy_one_file(const char *esp_path, const char *name, bool force) {
         char *p = NULL, *q = NULL, *v = NULL;
         int r;
 
-        if (asprintf(&p, "/usr/lib/gummiboot/%s", name) < 0) {
+        if (asprintf(&p, GUMMIBOOTLIBDIR "/%s", name) < 0) {
                 fprintf(stderr, "Out of memory.\n");
                 r = -ENOMEM;
                 goto finish;
@@ -795,9 +795,9 @@ static int install_binaries(const char *esp_path, bool force) {
                         return r;
         }
 
-        d = opendir("/usr/lib/gummiboot");
+        d = opendir(GUMMIBOOTLIBDIR);
         if (!d) {
-                fprintf(stderr, "Failed to open /usr/lib/gummiboot: %m\n");
+                fprintf(stderr, "Failed to open "GUMMIBOOTLIBDIR": %m\n");
                 return -errno;
         }
 
-- 
1.8.1.5

